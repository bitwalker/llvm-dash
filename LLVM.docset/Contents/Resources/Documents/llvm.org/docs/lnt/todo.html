
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  
<!-- Mirrored from llvm.org/docs/lnt/todo.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Apr 2014 21:32:27 GMT -->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>TODO &mdash; LNT 0.4.1dev documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.4.1dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="LNT 0.4.1dev documentation" href="index-2.html" />
    <link rel="next" title="lnt.testing – Test Data Creation" href="modules/testing.html" />
    <link rel="prev" title="Changelog" href="changes.html" />
<style type="text/css">
  table.right { float: right; margin-left: 20px; }
  table.right td { border: 1px solid #ccc; }
</style>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="modules/testing.html" title="lnt.testing – Test Data Creation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="changes.html" title="Changelog"
             accesskey="P">previous</a> |</li>
  <li><a href="index-2.html">LNT Home</a>&nbsp;|&nbsp;</li>
  <li><a href="contents.html">Documentation</a>&raquo;</li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="todo">
<span id="id1"></span><h1>TODO<a class="headerlink" href="#todo" title="Permalink to this headline">¶</a></h1>
<p>This is a TODO list of major and minor features for LNT.</p>
<div class="section" id="major-features">
<h2>Major Features<a class="headerlink" href="#major-features" title="Permalink to this headline">¶</a></h2>
<p>Too many to name!</p>
</div>
<div class="section" id="minor-features">
<h2>Minor Features<a class="headerlink" href="#minor-features" title="Permalink to this headline">¶</a></h2>
<p>Optimize test distribution format for common cases.</p>
<blockquote>
<div><p>1. We should left the test info higher in the format, so that it can easily be
shared by a large number of samples.</p>
<p>2. We should specify test samples in an array instead of objects, to avoid
requiring repetitive &#8216;Name&#8217; and &#8216;Data&#8217; keys.</p>
<ol class="arabic simple" start="3">
<li>We should support [test, sample] in addition to [test, [sample, ...]].</li>
</ol>
<p>4. If we changed the .success marker to be .failure, then having [test] be a
shortcut for [test, 0] would be fairly nice, and in the visualization we would
automatically get the right defaulting for absent tests.</p>
</div></blockquote>
<p>These changes would significantly compact the archive format, which improves
performance across the board.</p>
<p>Other stuff:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">We should find ways to manage the SQLite databases better. Currently we:</p>
<p>o Could benefit from having LNT manage when to run ANALYZE.</p>
<dl class="docutils">
<dt>o Could benefit from making LNT handle setting some of the page size</dt>
<dd><p class="first last">pragmas, at some point.</p>
</dd>
<dt>o Could benefit from finding a way to have LNT VACUUM, although this can be</dt>
<dd><p class="first last">very expensive.</p>
</dd>
</dl>
</li>
<li><p class="first">We should get an LNT buildbot up somewhere.</p>
</li>
<li><p class="first">We should start defining performance tests for LNT itself, and have LNT
monitor them (of course). Probably best integrated into the LNT buildbot.</p>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="v0-4-redesign">
<h2>v0.4 Redesign<a class="headerlink" href="#v0-4-redesign" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul>
<li><p class="first">Kill parameter sets.</p>
<dl class="docutils">
<dt>o Is this actual worth doing? If we just bring up dual models for a while</dt>
<dd><p class="first last">there is no reason to spend time on the old model.</p>
</dd>
</dl>
<p>o Counter argument is that it might make migrating code more simple.</p>
<dl class="docutils">
<dt>o Another counter argument is that we want to remove these from some places</dt>
<dd><p class="first last">that just migrating the schema won&#8217;t touch (like the submission format).</p>
</dd>
</dl>
</li>
<li><p class="first">Add schema version to test submission format (for future future proofing).</p>
</li>
<li><p class="first">Schema redesign:</p>
<p>o Plan on doing a dual submission model for bringup purposes.</p>
<dl class="docutils">
<dt>o Part of the planned schema design is to have proper attributes for the rows</dt>
<dd><p class="first last">in the run table. Should we moved to a typed model?</p>
</dd>
</dl>
<p>o See below.</p>
</li>
<li><p class="first">Open question: UI rewrite at the same time? We are going to have to do a
metric ton of rewrite work to adapt to the new schema anyway.</p>
</li>
<li><p class="first">Open question: Introduce Mongo dependency? I would rather not, from a
dependency perspective, but I also would really like to have mongo
available. Also I am almost certainly going to want to move llvmlab to using
mongo so it is an effective dependency on the server. Having it as a
dependency for local use seems sucky though. Shame there isn&#8217;t a local
isolated mongo-as-a-library client.</p>
<p>o CONCLUSION: Not for v0.4.</p>
</li>
<li><p class="first">Run order redesign?</p>
<dl class="docutils">
<dt>o The current run order design is really unfortunate. It would be much better</dt>
<dd><p class="first last">if we could provide a way for users to report all of the important
revisions. Unfortunately, this places a lot of requirements on the server
for understanding all the repositories, especially the git based ones.</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<div class="section" id="schema-resign">
<h3>Schema Resign<a class="headerlink" href="#schema-resign" title="Permalink to this headline">¶</a></h3>
<div class="section" id="primary-purpose">
<h4>Primary Purpose<a class="headerlink" href="#primary-purpose" title="Permalink to this headline">¶</a></h4>
<p>The primary purpose of the schema redesign is to eliminate what Bill Karwin
calls the &#8220;Entity-Attribute-Value&#8221; anti-pattern in his book SQL
Antipatterns. This is where we basically store arbitrary dictionaries of
attributes in the various Info tables, which I have since discovered is a
terrible idea for all the reasons Karwin articulates.</p>
<p>The particular difficulty with following this within the other LNT design goals
is that we still have the desire to allow users to report very flexible
structured data.</p>
<p>Currently, the best idea to have to resolve this conflict is that we will
construct tables on the fly. I suspect many SQL experts might also regard that
as an anti- or scary- pattern, but it seems like the best option to me. If one
thinks of LNT as trying to be a general purpose product, then the idea of
creating tables is notionally related to the specialization (instantiation) of
the general purpose product for one&#8217;s particular test suites.</p>
<p>However, we certainly also want to limit the degree to which we create or modify
tables. Having the test submission mechanism having to modify the table any time
a user reported a new key would certainly be superflous.</p>
<p>Thus, my current plan is to follow what Karwin calls the &#8220;Semistructured Data&#8221;
pattern. What we will do is add an arbitrary blob field (to be JSON or perhaps
BSON data). We will basically expect that any fields that are required (or
almost always used) to be put in the actual table schema, but any time we see
additional fields we can handle them by just placing them in the BLOB field.</p>
<p>We will probably allow users to migrate fields to and from the schema. This
gives us a good amount of flexibility (and an easy path to eliminate the JSON
field if need be). We may require users to do this before they can do anything
but just see the data associated with a run. For example, if they want to use
one of the reported fields as an axis.</p>
</div>
<div class="section" id="secondary-purpose">
<h4>Secondary Purpose<a class="headerlink" href="#secondary-purpose" title="Permalink to this headline">¶</a></h4>
<p>One additional painful part of the current schema design is that we use separate
tests to represent the status aspect of other tests. This is nice and flexible,
but makes the UI code very painful. Especially, some things like making a graph
of the test values for all tests which passed become incredibly complex.</p>
<p>The plan is to handle this problem by also constructing the Sample tables on the
fly, and allowing the test suite to define the keys that go into a sample. Thus,
any one sample will reflect <em>all</em> of the statistics that were reported for that
test.</p>
<dl class="docutils">
<dt>This has many advantages:</dt>
<dd><ul class="first last simple">
<li>We can start using types for the columns (e.g., easy to start reporting hash
of produced binaries, for example).</li>
<li>The performance impact of adding new sample values should be much lower than
in the old schema.</li>
<li>The database explicitly models the fact that sample values were produced from
a single run, whereas before sample values and status could not technically
be correlated correctly.</li>
<li>We eliminate the need to mangle subtest/test result key information into the
test name, which is a big win.</li>
</ul>
</dd>
<dt>The has some disadvantages, however:</dt>
<dd><ul class="first last simple">
<li>Poorly models suites where different tests reported different test results.</li>
<li>Poorly models situations where we want to support a large number of test
results and that set might change frequently or dynamically (e.g., suppose we
reported one test for each LLVM Statistic counter).</li>
</ul>
</dd>
</dl>
<p>However, at least for our current usage this scheme should work well enough and
be <strong>substantially</strong> faster than the old scheme.</p>
<p>This will probably mean that we have to do a bit of work (similar to what we had
to do for parameter sets) to handle what the UI for this should look
like. However, we should have better infrastructure for defining how the UI
should handle things in the metadata.</p>
</div>
<div class="section" id="other-antipatterns-in-use">
<h4>Other Antipatterns In Use<a class="headerlink" href="#other-antipatterns-in-use" title="Permalink to this headline">¶</a></h4>
<p>The &#8220;status kind&#8221; field uses and suffers from a view of the problems mentioned
in Chapter 11. 31 Flavors. It would probably be good to move being foreign key
references into an auxiliary table. This also reduces some of my reservations
about making that field required / part of every test.</p>
<p>Conveniently, this can also be done without actually changing the status kind
values, which makes migration easy.</p>
</div>
</div>
<div class="section" id="proposed-concepts">
<h3>Proposed Concepts<a class="headerlink" href="#proposed-concepts" title="Permalink to this headline">¶</a></h3>
<div class="section" id="test-suite">
<h4>Test Suite<a class="headerlink" href="#test-suite" title="Permalink to this headline">¶</a></h4>
<p>The major high level concept in the new schema is that of a test suite. This is
designed to correspond to some group of tests which users would browse
independently. Examples would be things like &#8220;LLVM Test Suite&#8221; or &#8220;PlumHall&#8221; or
&#8220;GCC Test Suite&#8221;.</p>
<p>The test suite is the place that defines information about what is being tested
and the metadata on what information is reported by the runs and the tests.</p>
</div>
<div class="section" id="parameter-sets">
<h4>Parameter Sets<a class="headerlink" href="#parameter-sets" title="Permalink to this headline">¶</a></h4>
<p>This concept will be removed. Instead, the idea is that all the information
about how a test was run lives at the Run level. This corresponds much more to
how LNT is currently primarily used in production. Although there were tests
like the Clang tests which made use of parameter sets, the theory is that we
should only have one place for parameters, and a lot of them have to be in the
Run. The goal is that the UI will be enhanced to better support situations when
one group of tests was split up into multiple Runs. We should also eventually
support submitting multiple runs in one submission.</p>
</div>
</div>
<div class="section" id="proposed-migration-path">
<h3>Proposed Migration Path<a class="headerlink" href="#proposed-migration-path" title="Permalink to this headline">¶</a></h3>
<p>I would prefer to not do any coordinated changes to the non-DB side of things
while effecting the database changes (and generally, I like the test submission
format to be fairly stable).</p>
<p>For the most part, I think this can be done relatively easily, but there are a
few places that will require special care.</p>
<blockquote>
<div><ul>
<li><p class="first">For parameter sets (TestInfo), we just discard them and reject any attempts
to use them.</p>
</li>
<li><p class="first">For MachineInfo, we just turn them into the Parameters BLOB or put them in
the appropriate column.</p>
</li>
<li><p class="first">For RunInfo, we just turn them into the Parameters BLOB or put them in the
appropriate column.</p>
<p>We will need to extract the run_order value and put it into the order table.</p>
<p>This points out that we probably want the order table to be UNIQUE across all
entries. Can we do that in SQLite3?</p>
</li>
<li><p class="first">For the sample status field, we will need to convert the existing format,
which encodes samples via multiple tests, into the new format.</p>
<p>This is the one area where I really don&#8217;t want to change the test data
serialization format, so maybe this is even the right long term approach.</p>
<p>In the new model of collapsing samples into a single row, this is going to
mean that we will need to assume that tests mangled into subtest names are
specified in the same order.</p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="unaddressed-issues">
<h3>Unaddressed Issues<a class="headerlink" href="#unaddressed-issues" title="Permalink to this headline">¶</a></h3>
<p>There are couple design problems in the current system which I <em>am not</em>
intending to address as part of the v0.4 changes.</p>
<div class="section" id="machine-naming">
<h4>Machine Naming<a class="headerlink" href="#machine-naming" title="Permalink to this headline">¶</a></h4>
<p>LNT currently allows a &#8220;name&#8221; for machines, which is very arbitrary. It would be
nice to eliminate this field completely, but we should probably eliminate the
name from the UI completely first, and make sure that is workable.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">TODO</a><ul>
<li><a class="reference internal" href="#major-features">Major Features</a></li>
<li><a class="reference internal" href="#minor-features">Minor Features</a></li>
<li><a class="reference internal" href="#v0-4-redesign">v0.4 Redesign</a><ul>
<li><a class="reference internal" href="#schema-resign">Schema Resign</a><ul>
<li><a class="reference internal" href="#primary-purpose">Primary Purpose</a></li>
<li><a class="reference internal" href="#secondary-purpose">Secondary Purpose</a></li>
<li><a class="reference internal" href="#other-antipatterns-in-use">Other Antipatterns In Use</a></li>
</ul>
</li>
<li><a class="reference internal" href="#proposed-concepts">Proposed Concepts</a><ul>
<li><a class="reference internal" href="#test-suite">Test Suite</a></li>
<li><a class="reference internal" href="#parameter-sets">Parameter Sets</a></li>
</ul>
</li>
<li><a class="reference internal" href="#proposed-migration-path">Proposed Migration Path</a></li>
<li><a class="reference internal" href="#unaddressed-issues">Unaddressed Issues</a><ul>
<li><a class="reference internal" href="#machine-naming">Machine Naming</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="changes.html"
                        title="previous chapter">Changelog</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="modules/testing.html"
                        title="next chapter"><tt class="docutils literal docutils literal"><span class="pre">lnt.testing</span></tt> &#8211; Test Data Creation</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="http://llvm.org/docs/lnt/search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="modules/testing.html" title="lnt.testing – Test Data Creation"
             >next</a> |</li>
        <li class="right" >
          <a href="changes.html" title="Changelog"
             >previous</a> |</li>
  <li><a href="index-2.html">LNT Home</a>&nbsp;|&nbsp;</li>
  <li><a href="contents.html">Documentation</a>&raquo;</li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Daniel Dunbar.
      Last updated on 2013-04-16.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>

<!-- Mirrored from llvm.org/docs/lnt/todo.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Apr 2014 21:32:27 GMT -->
</html>
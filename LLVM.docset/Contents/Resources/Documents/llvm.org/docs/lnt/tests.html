
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  
<!-- Mirrored from llvm.org/docs/lnt/tests.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Apr 2014 21:32:27 GMT -->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Test Producers &mdash; LNT 0.4.1dev documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.4.1dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="LNT 0.4.1dev documentation" href="index-2.html" />
    <link rel="next" title="Changelog" href="changes.html" />
    <link rel="prev" title="The lnt Tool" href="tools.html" />
<style type="text/css">
  table.right { float: right; margin-left: 20px; }
  table.right td { border: 1px solid #ccc; }
</style>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="changes.html" title="Changelog"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="tools.html" title="The lnt Tool"
             accesskey="P">previous</a> |</li>
  <li><a href="index-2.html">LNT Home</a>&nbsp;|&nbsp;</li>
  <li><a href="contents.html">Documentation</a>&raquo;</li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="test-producers">
<span id="tests"></span><h1>Test Producers<a class="headerlink" href="#test-producers" title="Permalink to this headline">¶</a></h1>
<p>On the client-side, LNT comes with a number of built-in test data producers.
This section focuses on the LLVM test-suite (aka nightly test) generator, since
it is the primary test run using the LNT infrastructure, but note that LNT also
includes tests for other interesting pieces of data, for example Clang
compile-time performance.</p>
<p>LNT also makes it easy to add new test data producers and includes examples of
custom data importers (e.g., to import buildbot build information into) and
dynamic test data generators (e.g., abusing the infrastructure to plot graphs,
for example).</p>
<div class="section" id="running-a-local-server">
<h2>Running a Local Server<a class="headerlink" href="#running-a-local-server" title="Permalink to this headline">¶</a></h2>
<p>It is useful to set up a local LNT server to view the results of tests, either
for personal use or to preview results before submitting them to a public
server. To set up a one-off server for testing:</p>
<div class="highlight-python"><pre># Create a new installation in /tmp/FOO.
$ lnt create /tmp/FOO
created LNT configuration in '/tmp/FOO'
...

# Run a local LNT server.
$ lnt runserver /tmp/FOO &amp;&gt; /tmp/FOO/runserver.log &amp;
[2] 69694

# Watch the server log.
$ tail -f /tmp/FOO/runserver.log
* Running on http://localhost:8000/
...</pre>
</div>
</div>
<div class="section" id="running-tests">
<h2>Running Tests<a class="headerlink" href="#running-tests" title="Permalink to this headline">¶</a></h2>
<p>The built-in tests are designed to be run via the <tt class="docutils literal"><span class="pre">lnt</span></tt> tool. The
following tools for working with built-in tests are available:</p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">lnt</span> <span class="pre">showtests</span></tt></dt>
<dd>List the available tests.  Tests are defined with an extensible
architecture. FIXME: Point at docs on how to add a new test.</dd>
<dt><tt class="docutils literal"><span class="pre">lnt</span> <span class="pre">runtest</span> <span class="pre">[&lt;run</span> <span class="pre">options&gt;]</span> <span class="pre">&lt;test</span> <span class="pre">name&gt;</span> <span class="pre">...</span> <span class="pre">test</span> <span class="pre">arguments</span> <span class="pre">...</span></tt></dt>
<dd><p class="first">Run the named test. The run tool itself accepts a number of options which
are common to all tests. The most common option is <tt class="docutils literal"><span class="pre">--submit=&lt;url&gt;</span></tt> which
specifies the server to submit the results to after testing is complete. See
<tt class="docutils literal"><span class="pre">lnt</span> <span class="pre">runtest</span> <span class="pre">--help</span></tt> for more information on the available options.</p>
<p class="last">The remainder of the options are passed to the test tool itself. The options
are specific to the test, but well behaved tests should respond to <tt class="docutils literal"><span class="pre">lnt</span>
<span class="pre">runtest</span> <span class="pre">&lt;test</span> <span class="pre">name&gt;</span> <span class="pre">--help</span></tt>. The following section provides specific
documentation on the built-in tests.</p>
</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="built-in-tests">
<h2>Built-in Tests<a class="headerlink" href="#built-in-tests" title="Permalink to this headline">¶</a></h2>
<div class="section" id="llvm-test-suite-aka-llvm-nightly-test">
<h3>LLVM test-suite (aka LLVM nightly test)<a class="headerlink" href="#llvm-test-suite-aka-llvm-nightly-test" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">nt</span></tt> built-in test runs the LLVM test-suite execution and performance
tests, in the &#8220;nightly test&#8221; configuration. This test allows running many
different applications and benchmarks (e.g., SPEC), with various compile
options, and in several different configurations (for example, using an LLVM
compiler like <tt class="docutils literal"><span class="pre">clang</span></tt> or <tt class="docutils literal"><span class="pre">llvm-gcc</span></tt>, running under the LLVM JIT compiler
using the LLVM <tt class="docutils literal"><span class="pre">lli</span></tt> bit-code interpreter, or testing new code generator
passes).</p>
<p>The <tt class="docutils literal"><span class="pre">nt</span></tt> test requires that the LLVM test-suite repository, a working LLVM
compiler, and a LLVM source and build tree are available. Currently, the LLVM
build tree is expected to have been built-in the Release+Asserts configuration.
Unlike the prior <tt class="docutils literal"><span class="pre">NewNightlyTest.pl</span></tt>, the <tt class="docutils literal"><span class="pre">nt</span></tt> tool does not checkout or build
any thing, it is expected that users manage their own LLVM source and build
trees. Ideally, each of the components should be based on the same LLVM revision
(except perhaps the LLVM test-suite), but this is not required.</p>
<p>The test runs the LLVM test-suite builds and execution inside a user specificed
sandbox directory. By default, each test run will be done in a timestamped
directory inside the sandbox, and the results left around for post-mortem
analysis. Currently, the user is responsible for cleaning up these directories
to manage disk space.</p>
<p>The tests are always expected to be run using out-of-tree builds &#8211; this is a
more robust model and allow sharing the same source trees across many test
runs. One current limitation is that the LLVM test-suite repository will not
function correctly if an in-tree build is done, followed by an out-of-tree
build. It is very important that the LLVM test-suite repository be left
pristine.</p>
<p>The following command shows an example of running the <tt class="docutils literal"><span class="pre">nt</span></tt> test suite on a
local build:</p>
<div class="highlight-python"><pre>$ rm -rf /tmp/BAR
$ lnt runtest nt \
     --sandbox /tmp/BAR \
     --cc ~/llvm.obj.64/Release+Asserts/bin/clang \
     --cxx ~/llvm.obj.64/Release+Asserts/bin/clang++ \
     --llvm-src ~/llvm \
     --llvm-obj ~/llvm.obj.64 \
     --test-suite ~/llvm-test-suite \
     TESTER_NAME \
      -j 16
2010-04-17 23:46:40: using nickname: 'TESTER_NAME__clang_DEV__i386'
2010-04-17 23:46:40: creating sandbox: '/tmp/BAR'
2010-04-17 23:46:40: starting test in '/private/tmp/BAR/test-2010-04-17_23-46-40'
2010-04-17 23:46:40: configuring...
2010-04-17 23:46:50: testing...
2010-04-17 23:51:04: loading test data...
2010-04-17 23:51:05: generating report: '/private/tmp/BAR/test-2010-04-17_23-46-40/report.json'</pre>
</div>
<p>The first seven arguments are all required &#8211; they specify the sandbox path, the
compilers to test, and the paths to the required sources and builds. The
<tt class="docutils literal"><span class="pre">TESTER_NAME</span></tt> argument is used to derive the name for this tester (in
conjunction which some inferred information about the compiler under test). This
name is used as a short identifier for the test machine; generally it should be
the hostname of the machine or the name of the person who is responsible for the
tester. The <tt class="docutils literal"><span class="pre">-j</span> <span class="pre">16</span></tt> argument is optional, in this case it specifies that tests
should be run in parallel using up to 16 processes.</p>
<p>In this case, we can see from the output that the test created a new sandbox
directory, then ran the test in a subdirectory in that sandbox. The test outputs
a limited about of summary information as testing is in progress. The full
information can be found in .log files within the test build directory (e.g.,
<tt class="docutils literal"><span class="pre">configure.log</span></tt> and <tt class="docutils literal"><span class="pre">test.log</span></tt>).</p>
<p>The final test step was to generate a test report inside the test
directory. This report can now be submitted directly to an LNT server. For
example, if we have a local server running as described earlier, we can run:</p>
<div class="highlight-python"><pre>$ lnt submit --commit=1 http://localhost:8000/submitRun \
    /tmp/BAR/test-2010-04-17_23-46-40/report.json
STATUS: 0

OUTPUT:
IMPORT: /tmp/FOO/lnt_tmp/data-2010-04-17_16-54-35ytpQm_.plist
  LOAD TIME: 0.34s
  IMPORT TIME: 5.23s
ADDED: 1 machines
ADDED: 1 runs
ADDED: 1990 tests
COMMITTING RESULT: DONE
TOTAL IMPORT TIME: 5.57s</pre>
</div>
<p>and view the results on our local server.</p>
<div class="section" id="lnt-based-nt-test-modules">
<h4>LNT-based NT test modules<a class="headerlink" href="#lnt-based-nt-test-modules" title="Permalink to this headline">¶</a></h4>
<p>In order to support more complicated tests, or tests which are not easily
integrated into the more strict SingleSource or MultiSource layout of the LLVM
test-suite module, the <tt class="docutils literal"><span class="pre">nt</span></tt> built-in test provides a mechanism for LLVM
test-suite tests that just define an extension test module. These tests are
passed the user configuration parameters for a test run and expected to return
back the test results in the LNT native format.</p>
<p>Test modules are defined by providing a <tt class="docutils literal"><span class="pre">TestModule</span></tt> file in a subdirectory of
the <tt class="docutils literal"><span class="pre">LNTBased</span></tt> root directory inside the LLVM test-suite repository. The
<tt class="docutils literal"><span class="pre">TestModule</span></tt> file is expected to be a well-formed Python module that provides
a <tt class="docutils literal"><span class="pre">test_class</span></tt> global variable which should be a subclass of the
<tt class="docutils literal"><span class="pre">lnt.tests.nt.TestModule</span></tt> abstract base class.</p>
<p>The test class should override the <tt class="docutils literal"><span class="pre">execute_test</span></tt> method which is passed an
options dictionary containg the NT user parameters which apply to test
execution, and the test should return the test results as a list of
<tt class="docutils literal"><span class="pre">lnt.testing.TestSamples</span></tt> objects.</p>
<p>The <tt class="docutils literal"><span class="pre">execute_test</span></tt> method is passed the following options describing
information about the module itself:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">MODULENAME</span></tt> - The name of the module (primarily intended for use in
producing well structured test names).</li>
<li><tt class="docutils literal"><span class="pre">SRCROOT</span></tt> - The path to the modules source directory.</li>
<li><tt class="docutils literal"><span class="pre">OBJROOT</span></tt> - The path to a directory the module should use for temporary
output (build products). The directory is guaranteed to exist but is not
guaranteed to be clean.</li>
</ul>
</div></blockquote>
<p>The method is passed the following options which apply to how tests should be
executed:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">THREADS</span></tt> - The number of parallel processes to run during testing.</li>
<li><tt class="docutils literal"><span class="pre">BUILD_THREADS</span></tt> - The number of parallel processes to use while building
tests (if applicable).</li>
</ul>
</div></blockquote>
<p>The method is passed the following options which specify how and whether tests
should be executed remotely. If any of these parameters are present then all are
guaranteed to be present.</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">REMOTE_HOST</span></tt> - The host name of the remote machine to execute tests on.</li>
<li><tt class="docutils literal"><span class="pre">REMOTE_USER</span></tt> - The user to log in to the remote machine as.</li>
<li><tt class="docutils literal"><span class="pre">REMOTE_PORT</span></tt> - The port to connect to the remote machine on.</li>
<li><tt class="docutils literal"><span class="pre">REMOTE_CLIENT</span></tt> - The <tt class="docutils literal"><span class="pre">rsh</span></tt> compatible client to use to connect to the
remote machine with.</li>
</ul>
</div></blockquote>
<p>The method is passed the following options which specify how to build the tests:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">CC</span></tt> - The C compiler command to use.</li>
<li><tt class="docutils literal"><span class="pre">CXX</span></tt> - The C++ compiler command to use.</li>
<li><tt class="docutils literal"><span class="pre">CFLAGS</span></tt> - The compiler flags to use for building C code.</li>
<li><tt class="docutils literal"><span class="pre">CXXFLAGS</span></tt> - The compiler flags to use for building C++ code.</li>
</ul>
</div></blockquote>
<p>The method is passed the following optional parameters which specify the
environment to use for various commands:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">COMPILE_ENVIRONMENT_OVERRIDES</span></tt> [optional] - If given, a <tt class="docutils literal"><span class="pre">env</span></tt> style list
of environment overrides to use when compiling.</li>
<li><tt class="docutils literal"><span class="pre">LINK_ENVIRONMENT_OVERRIDES</span></tt> [optional] - If given, a <tt class="docutils literal"><span class="pre">env</span></tt> style list of
environment overrides to use when linking.</li>
<li><tt class="docutils literal"><span class="pre">EXECUTION_ENVIRONMENT_OVERRIDES</span></tt> [optional] - If given, a <tt class="docutils literal"><span class="pre">env</span></tt> style list of
environment overrides to use when executing tests.</li>
</ul>
</div></blockquote>
<p>For more information, see the example tests in the LLVM test-suite repository
under the <tt class="docutils literal"><span class="pre">LNT/Examples</span></tt> directory.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Test Producers</a><ul>
<li><a class="reference internal" href="#running-a-local-server">Running a Local Server</a></li>
<li><a class="reference internal" href="#running-tests">Running Tests</a></li>
<li><a class="reference internal" href="#built-in-tests">Built-in Tests</a><ul>
<li><a class="reference internal" href="#llvm-test-suite-aka-llvm-nightly-test">LLVM test-suite (aka LLVM nightly test)</a><ul>
<li><a class="reference internal" href="#lnt-based-nt-test-modules">LNT-based NT test modules</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="tools.html"
                        title="previous chapter">The <tt class="docutils literal docutils literal"><span class="pre">lnt</span></tt> Tool</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="changes.html"
                        title="next chapter">Changelog</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="http://llvm.org/docs/lnt/search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="changes.html" title="Changelog"
             >next</a> |</li>
        <li class="right" >
          <a href="tools.html" title="The lnt Tool"
             >previous</a> |</li>
  <li><a href="index-2.html">LNT Home</a>&nbsp;|&nbsp;</li>
  <li><a href="contents.html">Documentation</a>&raquo;</li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Daniel Dunbar.
      Last updated on 2013-04-16.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>

<!-- Mirrored from llvm.org/docs/lnt/tests.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Apr 2014 21:32:27 GMT -->
</html>